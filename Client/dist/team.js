webpackJsonp([2],{267:function(e,t,o){(function(e,t,n,a){var s=o(8),i=o(31),r=o(33),d=o(34),p=o(6);e.get("id")?e.get("teamId")||(location.href="../project/project.html"):location.href="../login/login.html",e.remove("projectId"),e.remove("projectName"),e.remove("role"),e.remove("own"),e.remove("lastBaseUrl"),e.remove("versionId"),e.remove("versionName"),e.remove("versionDis");new t({el:"#app",data:{session:n.clone(e.raw()),type:0,obj:{notice:[],project:[],user:[]},showAdd:!1,addPending:!1,newType:0,name:"",dis:"",id:"",arrApply:[],showApply:!1,applyPending:!1,showUserApply:!1,newUserGroup:"",newUserRole:1,selUserApplyObj:{}},components:{mainnav:s,teaminfo:i,teamprojectlist:r,teamuser:d},methods:{addProject:function(){var t=this;if(0==this.newType){if(!this.name)return void this.$message.error("请输入名称");this.addPending=!0,a.post("/project/create",{name:t.name,dis:t.dis,team:e.get("teamId")}).then(function(e){t.addPending=!1,t.name="",t.dis="",200==e.code?(t.obj.project.unshift(e.data),n.notify("创建成功",1),t.showAdd=!1,p.$emit("updateTeamProject",1,0)):n.notify(e.msg,0)})}else{if(!this.id)return void this.$message.error("请输入项目ID");this.addPending=!0,a.put("/team/pullproject",{id:e.get("teamId"),project:this.id}).then(function(e){t.addPending=!1,t.name="",t.dis="",t.id="",200==e.code?(n.notify("请求已发出，等待项目管理员响应",1),t.showAdd=!1):n.notify(e.msg,0)})}},importProject:function(){n.showBox(this,"importProject")},addGroup:function(){var t=this;n.input("请输入部门名称",function(o){if(!o.value)return void n.tip("请输入部门名称",0);n.startHud(),a.post("/team/group",{id:e.get("teamId"),name:o.value}).then(function(e){n.stopHud(),200==e.code?(n.notify("新建成功",1),t.obj.user.push(e.data)):n.notify(e.msg,0)})})},handleApply:function(t,o){var s=this;2==t.type?(this.newUserGroup=this.obj.user[0]._id,this.newUserRole=1,this.showUserApply=!0,this.selUserApplyObj={item:t,state:o}):3==t.type&&(n.startHud(),a.put("/team/apply",{id:e.get("teamId"),apply:t._id,state:o}).then(function(e){n.stopHud(),200==e.code?"object"==typeof e.data?(t.handle=1,s.obj.project.unshift(e.data),p.$emit("updateTeamProject",1,e.data.interfaceCount),p.$emit("updateTeamUser",e.data.userAddCount)):t.handle=2:(t.handle=3,n.notify(e.msg,0))}))},handleUserApply:function(){var t=this;this.applyPending=!0,a.put("/team/apply",{id:e.get("teamId"),apply:this.selUserApplyObj.item._id,group:this.newUserGroup,role:this.newUserRole,state:this.selUserApplyObj.state}).then(function(e){t.applyPending=!1,200==e.code?"object"==typeof e.data?(t.selUserApplyObj.item.handle=1,t.obj.user.forEach(function(o){o._id==t.newUserGroup&&(o.users.push(e.data),o.users.sort(function(e,t){return e.user.name>t.user.name}))}),p.$emit("updateTeamUser",1)):t.selUserApplyObj.item.handle=2:(t.selUserApplyObj.item.handle=3,n.notify(e.msg,0)),t.showUserApply=!1})}},created:function(){var e=this;Promise.all([a.get("/team/info",{id:e.session.teamId}),a.get("/team/apply",{id:e.session.teamId})]).then(function(t){n.stopLoading();var o=t[0],a=t[1];if(200!=o.code)throw o.msg;if(e.obj=o.data,e.newUserGroup=o.data.user[0]._id,200!=a.code)throw a.msg;a.data.forEach(function(e){e.handle=0}),e.arrApply=a.data,e.arrApply.length>0&&(e.showApply=!0)}).catch(function(e){n.notify(e,0)})}});n.ready(function(){n.startLoading()})}).call(t,o(2),o(3),o(0),o(4))}},[267]);